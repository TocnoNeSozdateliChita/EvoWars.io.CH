var version = 7.02, gameServer = {
    connected: !1
}, latency = 0, lastLatency = 0, wasSync = !1, imDead = !1, saveKey, latencySummary = 0, latencySummaryAttempts = 0, wasSocketInit = !1, myExperience = null, lastOxygen = null, lastWater = null, lastSpectatorsCount = 0, lastMeName = "", lastMeId = 0, joinTime = 0, textEffects = [], lastDrawnExperience = 0, discordAsksArr = [], lastConditionsHTML = "", scanPlayersArr = [], migrating = !1, syncTick = 0, spawnTimerData = void 0, serverName = "", showBossTimer = !1, pingFunc = null, serversList = {}, connectIp = "";
function initSocket() {
    if (!wasSocketInit) {
        wasSocketInit = !0,
        gameServer = io(connectIp, {
            transports: ["websocket"],
            reconnection: !0,
            timeout: 5e3,
            reconnectionDelay: 10,
            reconnectionDelayMax: 500,
            reconnectionAttempts: 1 / 0
        });
        var disconnected = !1;
        gameServer.on("disconnect", (function() {
            console.log("disconnected from server"),
            joinedGame && !migrating && textMsg("Connection to the server has been lost. Reconnecting...", "red", 6e4),
            disconnected = !0,
            hideEmotesMenu()
        }
        )),
        gameServer.on("connect", (function() {
            $("#canvasGame").fadeIn(),
            console.log("connected to server"),
            Object.keys(game.gameObjects).forEach((function(e) {
                game.deleteObject(game.gameObjects[e])
            }
            )),
            brJoinMessageLastTime = 0,
            sawArr = [],
            joinedGame && (gameServer.emit("game:join", {
                nick: name,
                saveKey: saveKey,
                version: version,
                adblockDisabled: adblockDisabled,
                userData: user,
                startBonus: startBonus
            }),
            friendsData && friendsData.ids && friendsData.token && gameServer.emit("game:friends", friendsData),
            "poki" != partner && (window.onbeforeunload = confirmExit)),
            disconnected && (disconnected = !1,
            textMsg("Connected to the server", "green", 3500)),
            migrating && (textMsg(lang.migration_successful, "green", 3500),
            delete user.migrateExperience,
            delete user.migrateTime,
            delete user.migrateKey,
            delete user.migrateFactor,
            migrating = !1,
            $("#kick").fadeOut(500)),
            onServerConnect(),
            gameServer.emit("subscribeEvents", {
                userData: user
            })
        }
        )),
        gameServer.on("pong", (function(e) {
            if (latency = e / 2,
            game.latency = latency,
            latencySummary += latency,
            120 == ++latencySummaryAttempts)
                for (var t = 0; t < serversList.length; t++) {
                    var a = serversList[t];
                    if (connectIp == a.ip + ":" + a.port) {
                        parseInt(latencySummary / latencySummaryAttempts) <= 300 && gtag("event", a.location, {
                            event_category: "ping",
                            event_label: clientCountry,
                            value: parseInt(latencySummary / latencySummaryAttempts)
                        });
                        break
                    }
                }
            if (latency < 100)
                var i = "green";
            else if (latency < 200)
                i = "#ff8000";
            else
                i = "red";
            lastLatency != latency && ($("#gameContainer > div.debugInfo > div.latency").html('<font color="' + i + '">' + parseInt(latency) + " ms</font>"),
            lastLatency = latency)
        }
        )),
        gameServer.on("game:kick", (function(e) {
            $(".kickText").html(e.msg),
            $("#kick").fadeIn(500),
            window.onbeforeunload = null
        }
        )),
        gameServer.on("game:migrate", (function(e) {
            textMsg(lang.migrating, "#cc00cc", 1e4),
            setTimeout((function() {
                user.migrateExperience = e.data.experience,
                user.migrateTime = e.data.time,
                user.migrateKey = e.data.key,
                user.migrateFactor = e.data.factor,
                migrating = !0,
                connectIp = "wss://" + e.data.ip.replace(/\./g, "-") + ".evoworld.io:" + e.data.port,
                wasSocketInit = !1,
                gameServer.disconnect(),
                initSocket()
            }
            ), randomInteger(100, 4e3))
        }
        )),
        gameServer.on(socketMsgType.TEXTMSG, (function(e) {
            void 0 === e.time && (e.time = 7e3);
            var t = getTranslation("text_msg_" + e.text, e.parm);
            e.progress && (t += " " + e.progress),
            e.text >= 8 && e.text <= 10 && (t = "&#127873; " + t + " &#127873;"),
            e.text >= 11 && e.text <= 12 && (t = "&#128142; " + t + " &#128142;"),
            textMsg(t, e.color, e.time)
        }
        )),
        gameServer.on("game:dead", (function(e) {
            endGameText(e.killer, e.newExperience, e.newExperience, e.buyExperienceCostGems, e.buyExperienceCostTokens, e.oldExperience),
            lastDrawnExperience = -1,
            hideEmotesMenu(),
            imDead || (1 == pokiEnabled && PokiSDK.gameplayStop(),
            "undefined" != typeof CrazyGames && window.CrazyGames.SDK.game.gameplayStop()),
            imDead = !0
        }
        )),
        gameServer.on("game:joined", (function(e) {
            saveKey = e.saveKey,
            serverName = e.serverName,
            $("#gameContainer > div.debugInfo > div.server").html(serverName)
        }
        )),
        gameServer.on(socketMsgType.LEADERBOARD, (function(e) {
            refreshLeaderboard(e)
        }
        )),
        gameServer.on(socketMsgType.SYNC, (function(response) {
            if (syncTick++,
            spawnTimerData = response.d,
            void 0 !== response.c)
                for (var syncMessages = response.c, i = 0; i < syncMessages.length; i++) {
                    var syncMessage = syncMessages[i];
                    syncMessage.a == socketMsgType.REMOVEOBJECT && removeObject(syncMessage.b)
                }
            for (var forceRefreshExp = !1, objects = response.a, x = 0; x < objects.length; x++) {
                var object = objects[x];
                object.id = object.a,
                object.userId = object.a1,
                object.uid = object.b,
                object.position = object.c,
                object.moveSpeed = object.d,
                object.animation = animationsById[object.e],
                object.moveRangeX = object.f,
                object.hp = object.g,
                object.armor = object.g1,
                object.nick = object.h,
                object.level = object.i,
                object.premium = object.j,
                object.skin = object.k,
                object.flySide = object.l,
                object.countryCode = object.t,
                object.spawnTimer = object.st,
                object.pet = object.p1,
                object.arenaFrags = object.f1,
                object.typing = object.x,
                object.message = object.x1,
                object.shurikens = object.v,
                object.moveDirection = object.z,
                object.customData = object.q,
                void 0 !== object.position && (object.position.x = object.position.a,
                object.position.y = object.position.b,
                delete object.position.a,
                delete object.position.b),
                void 0 !== object.moveSpeed && (object.moveSpeed.x = object.moveSpeed.a,
                object.moveSpeed.y = object.moveSpeed.b,
                delete object.moveSpeed.a,
                delete object.moveSpeed.b),
                object.inHideId = object.n,
                void 0 === object.inHideId ? object.inHide = !1 : object.inHide = !0,
                object.poisoned = object.o,
                object.fire = object.p,
                object.infected = object.r,
                object.boostLock = object.u,
                object.grabbed = object.w,
                object.me = object.s,
                object.border = object.y,
                object.name = objectsByUniqueIdArr[object.uid].name;
                var me = object.me;
                if (game.gameObjects[object.id]) {
                    var modifyObject = game.gameObjects[object.id];
                    if (object.uid !== modifyObject.uid) {
                        var character = modifyObject;
                        character.animations = [];
                        var posX = character.position.x
                          , posY = character.position.y
                          , newPosX = posX - (game.objectsDef[object.name].width - character.width) / 2
                          , newPosY = posY - (game.objectsDef[object.name].height - character.height) / 2;
                        character.position.x = newPosX,
                        character.position.y = newPosY,
                        character.skill = void 0,
                        character.spaceResistance = !1,
                        character.eatsSouls = !1,
                        character.reapersIgnoreCollision = !1,
                        character.immortal = !1,
                        character.type == objectType.PLAYER && "overfedAlienBat" == character.name && (character.moveable = !0),
                        (!me || imDead && game.me.type == objectType.PLAYER) && (character.type != objectType.PLAYER || character.inHide || textEffects.push({
                            posX: character.position.x + character.width / 2,
                            posY: character.position.y + character.height,
                            color: "RED",
                            startTime: game.time,
                            text: "LVL UP",
                            fontSize: 12,
                            bold: !0
                        })),
                        game.objectAssign(modifyObject, game.objectsDef[object.name]),
                        delete character.collisionW,
                        delete character.collisionH,
                        delete character.collisionDx,
                        delete character.collisionDy
                    }
                    if (modifyObject.moveable ? (modifyObject.moveSpeed.x = object.moveSpeed.x,
                    modifyObject.moveSpeed.y = object.moveSpeed.y,
                    modifyObject.moveDirection = object.moveDirection,
                    modifyObject.interpolateTo.x = object.position.x + object.moveSpeed.x * latency / 1e3,
                    modifyObject.interpolateTo.y = object.position.y + object.moveSpeed.y * latency / 1e3) : modifyObject.needBeSynced && (modifyObject.position.x = object.position.x,
                    modifyObject.position.y = object.position.y,
                    0 == modifyObject.moveable && game.hashMap.updateObject(modifyObject)),
                    void 0 !== object.moveRangeX) {
                        var move = {
                            from: object.moveRangeX.a,
                            to: object.moveRangeX.b
                        };
                        modifyObject.moveRangeX = move
                    }
                    void 0 !== object.hp ? (modifyObject.hp > object.hp && (modifyObject.hitEffect = game.time),
                    modifyObject.hp = object.hp) : modifyObject.type != objectType.PLAYER && modifyObject.type != objectType.FOOD && modifyObject.type != objectType.BOSS || (modifyObject.hp = 100);
                    let e = modifyObject.armor;
                    void 0 !== object.armor ? modifyObject.armor = object.armor : modifyObject.type != objectType.PLAYER && modifyObject.type != objectType.FOOD && modifyObject.type != objectType.BOSS || (modifyObject.armor = 0),
                    e > modifyObject.armor && (modifyObject.armorBreakingEffect = !0),
                    modifyObject.type == objectType.PLAYER && (void 0 !== object.skin ? (modifyObject.skin = object.skin,
                    object.skin > 0 && game.loadSkin(object.name, object.skin)) : modifyObject.skin = void 0,
                    modifyObject.arenaFrags = object.arenaFrags,
                    modifyObject.typing = object.typing,
                    modifyObject.message = object.message,
                    object.message && stickMessageToObject(modifyObject),
                    void 0 === object.flySide || me && !imDead || (modifyObject.flySide = object.flySide),
                    1 != modifyObject.flySide && -1 != modifyObject.flySide || (modifyObject.direction = modifyObject.flySide),
                    0 == modifyObject.inHide && 1 == object.inHide && (modifyObject.inHideTime = game.time),
                    modifyObject.inHide = object.inHide,
                    object.inHide && (modifyObject.inHideId = object.inHideId),
                    void 0 !== object.pet && (modifyObject.petID = object.pet)),
                    (modifyObject.type == objectType.PLAYER || modifyObject.type == objectType.FOOD && modifyObject.hasSoul) && (void 0 !== object.poisoned ? modifyObject.poisoned = object.poisoned : modifyObject.poisoned = !1,
                    void 0 !== object.infected ? modifyObject.infected = object.infected : modifyObject.infected = !1,
                    void 0 !== object.fire ? modifyObject.fire = object.fire : modifyObject.fire = !1,
                    void 0 !== object.boostLock ? modifyObject.boostLock = object.boostLock : modifyObject.boostLock = !1,
                    void 0 !== object.grabbed ? modifyObject.grabbed = object.grabbed : modifyObject.grabbed = !1,
                    object.shurikens ? modifyObject.shurikens = object.shurikens : modifyObject.shurikens = 0),
                    setFillColorByState(game.gameObjects[object.id]),
                    modifyObject.type != objectType.PLAYER && void 0 !== object.animation && (modifyObject.animation = object.animation),
                    me && (game.me = modifyObject,
                    game.me.userId == user.id && (imDead = !1),
                    game.camera.holdOn = game.me,
                    lastMeName != game.me.name && (refreshYouEat(object.name),
                    forceRefreshExp = !0,
                    imDead || lastMeId != game.me.id || (refreshSkinChanger(),
                    setTimeout((function() {
                        textEffects.push({
                            posX: game.me.position.x + game.me.width / 2,
                            posY: game.me.position.y + game.me.height,
                            color: "RED",
                            startTime: game.time,
                            text: "LVL UP",
                            fontSize: 12,
                            bold: !0
                        })
                    }
                    ), 150)),
                    $("#gameContainer > div.status div.skillRight > div.bar").css({
                        height: "0%"
                    }),
                    lastMeName = game.me.name),
                    lastMeId = game.me.id),
                    modifyObject.syncTick = syncTick,
                    modifyObject.customData = object.customData
                } else {
                    var newObject = game.newObject(game.objectsDef[object.name]);
                    if (void 0 !== object.animation && (newObject.animation = object.animation),
                    newObject.id = object.id,
                    object.position && (newObject.position.x = object.position.x,
                    newObject.position.y = object.position.y),
                    newObject.syncTick = syncTick,
                    object.border && (newObject.border = object.border),
                    newObject.customData = object.customData,
                    newObject.type == objectType.FOOD && "pig" == object.name)
                        if (void 0 !== object.moveRangeX) {
                            var move = {
                                from: object.moveRangeX.a,
                                to: object.moveRangeX.b
                            };
                            newObject.moveRangeX = move,
                            addSawArr(object.id, "moveRangeX", move)
                        } else
                            newObject.moveRangeX = getSawArr(object.id, "moveRangeX");
                    void 0 !== object.hp ? newObject.hp = object.hp : newObject.type != objectType.PLAYER && newObject.type != objectType.FOOD && newObject.type != objectType.BOSS || (newObject.hp = 100),
                    void 0 !== object.armor ? newObject.armor = object.armor : newObject.type != objectType.PLAYER && newObject.type != objectType.FOOD && newObject.type != objectType.BOSS || (newObject.armor = 0),
                    newObject.type == objectType.PLAYER && (object.pet && (newObject.petID = object.pet),
                    void 0 !== object.userId ? (addSawArr(object.id, "userId", object.userId),
                    newObject.userId = object.userId) : newObject.userId = getSawArr(object.id, "userId"),
                    void 0 !== object.nick ? (addSawArr(object.id, "nick", object.nick),
                    newObject.nick = object.nick) : newObject.nick = getSawArr(object.id, "nick"),
                    void 0 !== object.premium ? (addSawArr(object.id, "premium", object.premium),
                    newObject.premium = object.premium) : newObject.premium = getSawArr(object.id, "premium"),
                    void 0 !== object.skin ? (newObject.skin = object.skin,
                    object.skin > 0 && game.loadSkin(newObject.name, object.skin)) : newObject.skin = void 0,
                    newObject.arenaFrags = object.arenaFrags,
                    newObject.typing = object.typing,
                    newObject.message = object.message,
                    object.message && stickMessageToObject(newObject),
                    void 0 !== object.level ? (addSawArr(object.id, "level", object.level),
                    newObject.level = object.level) : newObject.level = getSawArr(object.id, "level"),
                    void 0 !== object.countryCode ? (addSawArr(object.id, "countryCode", object.countryCode),
                    newObject.countryCode = object.countryCode) : newObject.countryCode = getSawArr(object.id, "countryCode"),
                    void 0 !== object.spawnTimer ? (addSawArr(object.id, "spawnTimer", object.spawnTimer),
                    newObject.spawnTimer = object.spawnTimer) : newObject.spawnTimer = getSawArr(object.id, "spawnTimer"),
                    void 0 !== object.flySide && (newObject.flySide = object.flySide),
                    1 == newObject.flySide || -1 == newObject.flySide ? newObject.direction = newObject.flySide : newObject.direction = 1,
                    newObject.moveable && (object.moveSpeed && (newObject.moveSpeed.x = object.moveSpeed.x,
                    newObject.moveSpeed.y = object.moveSpeed.y),
                    newObject.moveDirection = object.moveDirection),
                    newObject.inHide = object.inHide,
                    object.inHide && (newObject.inHideId = object.inHideId),
                    void 0 !== object.boostLock && (newObject.infected = object.boostLock),
                    void 0 !== object.grabbed && (newObject.grabbed = object.grabbed)),
                    (newObject.type == objectType.PLAYER || newObject.type == objectType.FOOD && newObject.hasSoul) && (void 0 !== object.poisoned && (newObject.poisoned = object.poisoned),
                    void 0 !== object.fire && (newObject.fire = object.fire),
                    void 0 !== object.infected && (newObject.infected = object.infected),
                    setFillColorByState(newObject),
                    object.shurikens && (newObject.shurikens = object.shurikens)),
                    me ? (game.me = game.addObject(newObject),
                    game.me.userId == user.id && (imDead = !1),
                    lastMeId = game.me.id,
                    lastMeName = game.me.name,
                    game.camera.holdOn = game.me,
                    forceRefreshExp = !0,
                    refreshYouEat(object.name),
                    imDead || refreshSkinChanger(),
                    $("#gameContainer > div.status div.skillRight > div.bar").css({
                        height: "0%"
                    })) : game.addObject(newObject)
                }
            }
            if (void 0 !== response.b) {
                var conditionsHTML = ""
                  , status = response.b;
                if (void 0 !== status.a && (status.water = Number(status.a).toFixed(2)),
                void 0 !== status.b && (status.oxygen = Number(status.b).toFixed(2)),
                void 0 !== status.h && (status.experiencePercent = Number(eval(status.h)).toFixed(2)),
                status.experience = status.c,
                status.skillCooldown = status.d,
                status.spectators = status.e,
                status.taxiCooldown = status.f,
                status.boss = status.g,
                status.battleRoyale = status.i,
                void 0 !== status.water && status.water != lastWater)
                    if (status.water < 0 && (status.water = 0),
                    imDead || (lastWater > 25 && status.water <= 25 || lastWater > 13 && status.water <= 13 || lastWater > 0 && status.water <= 0) && textMsg(lang.low_water_warning, "#1466b8", 8e3),
                    lastWater = status.water,
                    status.water < 25 ? $("#gameContainer > div.status div.waterBar").css({
                        background: "linear-gradient(90deg, #1466b8 " + status.water + "%, white " + status.water + "%)",
                        border: "3px solid red",
                        width: "calc(100% - 4px)"
                    }) : $("#gameContainer > div.status div.waterBar").css({
                        background: "linear-gradient(90deg, #1466b8 " + status.water + "%, white " + status.water + "%)",
                        border: "1px solid white",
                        width: "100%"
                    }),
                    game.me.inHide || game.me.inSafeZone) {
                        if (game.me.premium)
                            var timeleft = status.water / 100 * 1e3 / .55;
                        else
                            var timeleft = status.water / 100 * 1e3 / 3;
                        timeleft < 0 && (timeleft = 0);
                        var date = new Date(1e3 * timeleft)
                          , minutes = "0" + date.getMinutes()
                          , seconds = "0" + date.getSeconds()
                          , formattedTime = minutes.substr(-2) + ":" + seconds.substr(-2);
                        $("#gameContainer > div.status div.waterBar > span.timer").text(" (" + formattedTime + ")")
                    } else
                        $("#gameContainer > div.status div.waterBar > span.timer").text("");
                if (void 0 !== status.oxygen ? status.oxygen != lastOxygen && (status.oxygen < 0 && (status.oxygen = 0),
                imDead || (lastOxygen > 30 && status.oxygen <= 30 || lastOxygen > 13 && status.oxygen <= 13 || lastOxygen > 0 && status.oxygen <= 0) && (game.me.inSpace ? textMsg(lang.low_oxygen_warning_space, "#75b5f0", 8e3) : textMsg(lang.low_oxygen_warning, "#75b5f0", 8e3)),
                lastOxygen = status.oxygen,
                status.oxygen < 50 ? $("#gameContainer > div.status div.oxygenBar").css({
                    background: "linear-gradient(90deg, #75b5f0 " + status.oxygen + "%, white " + status.oxygen + "%)",
                    border: "3px solid red",
                    width: "calc(100% - 4px)"
                }) : $("#gameContainer > div.status div.oxygenBar").css({
                    background: "linear-gradient(90deg, #75b5f0 " + status.oxygen + "%, white " + status.oxygen + "%)",
                    border: "1px solid white",
                    width: "100%"
                })) : game.me.type == objectType.PLAYER && (100 == lastOxygen || game.me.deleted || $("#gameContainer > div.status div.oxygenBar").css({
                    background: "linear-gradient(90deg, #75b5f0 100%, white 100%)",
                    border: "1px solid white",
                    width: "100%"
                })),
                void 0 !== status.experience && null != status.experience && status.experience != myExperience && (myExperience = status.experience,
                forceRefreshExp = !0),
                forceRefreshExp) {
                    if (void 0 !== expTable[game.me.name]) {
                        var needExp = getExpFromTable(game.me.name)
                          , percent = (myExperience - needExp.fromExp) / (needExp.toExp - needExp.fromExp) * 100;
                        $("#gameContainer > div.status > div.experienceBar").css({
                            background: "linear-gradient(90deg, #e29ae1 " + percent + "%, white " + percent + "%)"
                        }),
                        $("#gameContainer > div.status > div.experienceBar").text(myExperience + "/" + needExp.toExp),
                        $("#currentClass").text(lang.current.capitalize() + ": " + currentName()),
                        $("#nextClass").text(lang.next.capitalize() + ": " + nextName())
                    } else {
                        var percent = 100;
                        $("#gameContainer > div.status > div.experienceBar").css({
                            background: "linear-gradient(90deg, #e29ae1 " + percent + "%, white " + percent + "%)"
                        }),
                        $("#gameContainer > div.status > div.experienceBar").text(myExperience + "/MAX"),
                        $("#currentClass").text(lang.current.capitalize() + ": " + currentName()),
                        $("#nextClass").text("")
                    }
                    myExperience != lastDrawnExperience && (-1 != lastDrawnExperience && myExperience > lastDrawnExperience && textEffects.push({
                        posX: game.me.position.x + game.me.width / 2,
                        posY: game.me.position.y + game.me.height,
                        color: "black",
                        startTime: game.time,
                        text: "+" + (myExperience - lastDrawnExperience),
                        fontSize: 12,
                        bold: !1
                    }),
                    lastDrawnExperience = myExperience)
                }
                if (void 0 !== game.me.skill && (void 0 !== status.skillCooldown ? (game.me.skillCooldown = status.skillCooldown,
                $("#gameContainer > div.status div.skillRight > div.bar").css({
                    height: status.skillCooldown / game.me.skill.cooldown * 100 + "%"
                }),
                $("#skillButton").css({
                    opacity: "0.2"
                })) : ($("#gameContainer > div.status div.skillRight > div.bar").css({
                    height: "0%"
                }),
                $("#skillButton").css({
                    opacity: "0.6"
                }))),
                void 0 === status.spectators && (status.spectators = 0,
                "undefined" != typeof spectatorMode && spectatorMode && (status.spectators = 1)),
                lastSpectatorsCount != status.spectators) {
                    var count = status.spectators;
                    $("#gameContainer > div.spectators > div.count").text(count),
                    0 == lastSpectatorsCount && $("#gameContainer > div.spectators").fadeIn(3e3),
                    0 == count && $("#gameContainer > div.spectators").fadeOut(2e3),
                    lastSpectatorsCount = count
                }
                if (game.me.premium && (conditionsHTML += "<div class='condition' style='background:#db433b'><div class='tooltip'><img crossorigin='anonymous' style='width: 90%;transform: translate(5%, 5%);' src='" + cdnServer + "images/shop/crown_4.png'><span class='tooltiptext' style='max-width:15vw;'>" + lang.you_have_premium + "</span></div></div>"),
                game.me.spawnTimer && (conditionsHTML += "<div class='condition' style='background:#303030'><div class='tooltip'><img crossorigin='anonymous'  style='width: 90%;transform: translate(6%, 5%);'src='" + cdnServer + "images/shop/spawn_timer.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_30") + "</span></div></div>"),
                showBossTimer = !1,
                void 0 !== status.boss) {
                    let e = status.boss.a
                      , t = status.boss.b;
                    if (e > 0) {
                        showBossTimer = !0;
                        let t = Math.floor(e / 60) + ":" + ("0" + e % 60).slice(-2);
                        conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/boss.png'><span class='timer'>" + t + "</span><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_28", t) + "</span></div></div>"
                    } else
                        t && (conditionsHTML += "<div class='condition' style='border: 3px solid #82ff82;box-sizing: border-box;'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/boss.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_29") + "</span></div></div>")
                }
                if (void 0 !== status.battleRoyale) {
                    let e = status.battleRoyale.a
                      , t = status.battleRoyale.b;
                    if (t > 0 && (!e || e > 300))
                        conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/battleRoyale.png'><span class='timer' style='color:white'>" + t + "</span><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_33", t) + "</span></div></div>";
                    else if (e > 0) {
                        let t = Math.floor(e / 60) + ":" + ("0" + e % 60).slice(-2);
                        conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/battleRoyale.png'><span class='timer'>" + t + "</span><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_32") + "</span></div></div>"
                    }
                }
                void 0 !== status.taxiCooldown && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/evoTaxi.png'><span class='timer'>" + status.taxiCooldown + "</span><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_15", status.taxiCooldown) + "</span></div></div>"),
                (game.me.inSafeZone || game.me.inHide) && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/safeZone.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_17") + "</span></div></div>"),
                game.me.inArenaZone && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/arenaZone.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_26") + "</span></div></div>"),
                game.me.inWater && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/diving.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_18") + "</span></div></div>"),
                game.me.inSwamp && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/swamp.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_19") + "</span></div></div>"),
                game.me.inLava && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/hotBath.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_20") + "</span></div></div>"),
                game.me.inToxic && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/toxic.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_21") + "</span></div></div>"),
                game.me.inSpace && game.me.inSpaceScale >= 100 && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/toTheMoon.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_22") + "</span></div></div>"),
                game.me.inEctoplasm && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/fireOfDeath.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_23") + "</span></div></div>"),
                game.me.infected && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/infection.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_1") + "</span></div></div>"),
                game.me.poisoned && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/poisonSwampMonster.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_2") + "</span></div></div>"),
                game.me.fire && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/burnInHell.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_3") + "</span></div></div>"),
                game.me.boostLock && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/conditions/boostLock.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_16") + "</span></div></div>"),
                game.me.grabbed && (conditionsHTML += "<div class='condition'><div class='tooltip'><img crossorigin='anonymous' src='" + cdnServer + "sprites/skills/grabPrey.png'><span class='tooltiptext' style='max-width:15vw;'>" + getTranslation("text_msg_4") + "</span></div></div>"),
                lastConditionsHTML != conditionsHTML && (lastConditionsHTML = conditionsHTML,
                $("#gameContainer>.conditions").html(conditionsHTML))
            }
            wasSync = !0
        }
        )),
        gameServer.on(socketMsgType.DOATTACK, (function(e) {
            var t = game.gameObjects[e.objectId]
              , a = e.direction;
            void 0 !== t && game.isVisible(game.camera, t, game.canvas.width / 2, game.canvas.height / 2) && doAttack(t, a)
        }
        )),
        gameServer.on(socketMsgType.DOPETATTACK, (function(e) {
            var t = game.gameObjects[e.attacker]
              , a = game.gameObjects[e.victim];
            void 0 === t || void 0 === a || void 0 === t.pet || t.pet.deleted || (t.pet.victim = a,
            t.pet.attackTime = game.time)
        }
        )),
        gameServer.on(socketMsgType.TEXTEFFECT, (function(e) {
            if (!document.hidden) {
                0 !== e.text.indexOf("SENTENCE_") && 0 !== e.text.indexOf("LANG_") || (e.text = lang[e.text]);
                for (var t = 0; t < textEffects.length; t++)
                    textEffects[t].posX === e.posX && textEffects[t].posY === e.posY && (textEffects.splice(t, 1),
                    t--);
                e.text && e.text.length > 0 && textEffects.push({
                    posX: e.posX,
                    posY: e.posY,
                    color: e.color,
                    text: e.text,
                    fontSize: e.fontSize,
                    bold: e.bold,
                    startTime: game.time,
                    static: e.static
                })
            }
        }
        )),
        gameServer.on(socketMsgType.TOMBSTONE, (function(e) {
            if (!document.hidden && void 0 !== game.objectsDef[e.name]) {
                var t = game.newObject(game.objectsDef[e.name]);
                t.id = null,
                t.position.x = e.posX - t.width / 2,
                t.position.y = e.posY - t.height / 2,
                t.moveSpeed.y = 100,
                game.addObject(t)
            }
        }
        )),
        gameServer.on(socketMsgType.NEWCHATMSG, (function(e) {
            gotNewChatMessage(e.fromId)
        }
        )),
        gameServer.on(socketMsgType.RELOADFRIENDS, (function(e) {
            refreshFriends()
        }
        )),
        gameServer.on(socketMsgType.EFFECT, (function(e) {
            if (!document.hidden) {
                if (0 === e.name.indexOf("evolution_effect_")) {
                    var t = "";
                    switch (parseInt(e.name.split("evolution_effect_")[1])) {
                    case 1:
                        t = "fireworks";
                        break;
                    case 2:
                        t = "fireworks_double";
                        break;
                    case 3:
                        t = "stars_lvlup";
                        break;
                    default:
                        return
                    }
                    var a = game.newObject(game.objectsDef[t])
                } else if (0 === e.name.indexOf("kill_effect_")) {
                    t = "";
                    switch (parseInt(e.name.split("kill_effect_")[1])) {
                    case 1:
                        t = "exploding_skull";
                        break;
                    case 2:
                        t = "dust";
                        break;
                    case 3:
                        t = "exploding_nova";
                        break;
                    default:
                        return
                    }
                    a = game.newObject(game.objectsDef[t])
                } else
                    a = game.newObject(game.objectsDef[e.name]);
                if (a.animation = e.animation,
                a.id = null,
                a.position.x = e.posX - a.width / 2,
                a.position.y = e.posY - a.height / 2,
                e.stickTo) {
                    var i = game.gameObjects[e.stickTo];
                    void 0 !== i && (a.stickTo = i)
                }
                game.addObject(a)
            }
        }
        )),
        gameServer.on(socketMsgType.EMOTE, (function(e) {
            if (!chatDisabled) {
                var t = game.gameObjects[e.character];
                void 0 !== t && (delete t.chat,
                stickEmoteToObject(t, e.emoteId, 0))
            }
        }
        )),
        gameServer.on(socketMsgType.LOOTINFO, (function(e) {
            var t = game.gameObjects[e.objectId];
            if (void 0 === t)
                return;
            let a = e.items;
            for (let e = 0; e < a.length; e++)
                addItemToLootInfo(t, a[e])
        }
        )),
        gameServer.on(socketMsgType.CHAT, (function(e) {
            if (!chatDisabled) {
                var t = game.gameObjects[e.character];
                void 0 !== t && (delete t.emote,
                stickChatToObject(t, e.chatId, 0, e.parm))
            }
        }
        )),
        gameServer.on(socketMsgType.ASKDISCORD, (function(e) {}
        )),
        gameServer.on(socketMsgType.SENDDISCORD, (function(e) {}
        )),
        gameServer.on(socketMsgType.SCANPLAYERS, (function(e) {
            e.length > 0 ? (scanPlayersArr = e,
            $("#scan-players-icon").attr("src", cdnServer + "images/scan-players-done.png").css("background", "rgb(0, 176, 0)").data("status", "ready").fadeIn(500)) : $("#scan-players-icon").fadeIn(500)
        }
        ))
    }
}
function copyToClipboard(e) {
    var t = document.createElement("textarea");
    t.innerHTML = e,
    document.body.appendChild(t),
    t.select();
    var a = document.execCommand("copy");
    return document.body.removeChild(t),
    a
}
function onServerConnect() {
    if ($("#scan-players-icon").data("status", "empty"),
    "undefined" != typeof christmasTime && christmasTime) {
        (e = game.newObject(game.objectsDef.christmasTree)).id = null,
        e.position.x = 63064,
        e.position.y = 2304;
        game.addObject(e);
        (e = game.newObject(game.objectsDef.giftBox)).id = null,
        e.position.x = 63164,
        e.position.y = 2292,
        game.addObject(e).addCollisionOnObtain(collisionOnObtain_GIFTBOX),
        (e = game.newObject(game.objectsDef.christmasTree)).id = null,
        e.position.x = 20114,
        e.position.y = 2304;
        game.addObject(e);
        (e = game.newObject(game.objectsDef.giftBox)).id = null,
        e.position.x = 20214,
        e.position.y = 2292,
        game.addObject(e).addCollisionOnObtain(collisionOnObtain_GIFTBOX),
        (e = game.newObject(game.objectsDef.christmasTree)).id = null,
        e.position.x = 44077,
        e.position.y = 2304;
        var e;
        game.addObject(e);
        (e = game.newObject(game.objectsDef.giftBox)).id = null,
        e.position.x = 44177,
        e.position.y = 2292,
        game.addObject(e).addCollisionOnObtain(collisionOnObtain_GIFTBOX)
    }
}
function removeObject(e) {
    e.id = e.a,
    e.killerId = e.b;
    var t = game.gameObjects[e.id];
    if (void 0 !== t) {
        if (void 0 !== e.killerId) {
            var a = game.newObject(game.objectsDef.skull);
            "flapping_right" == t.animation || "flying_right" == t.animation ? a.animation = "flapping_right" : a.animation = "flapping_left",
            a.id = t.id,
            a.position.x = t.position.x + t.width / 2 - a.width / 2,
            a.position.y = t.position.y + t.height / 2 - a.height / 2,
            a.zIndex = t.zIndex,
            t.killed = !0,
            game.deleteObject(t),
            game.me != t ? game.addObject(a) : game.me = game.addObject(a)
        } else
            game.deleteObject(t);
        if ("crate" == t.name && game.isVisible(game.camera, t, game.originalWidth / 2 + 100, game.originalHeight / 2 + 100))
            (a = game.newObject(game.objectsDef.crate_explosion)).id = null,
            a.position.x = t.position.x + t.width / 2 - a.width / 2,
            a.position.y = t.position.y + t.height / 2 - a.height / 2,
            a.zIndex = t.zIndex,
            game.addObject(a);
        if (t.inStaticCanvas)
            for (var i = game.hashMap.retrieve(t), o = 0; o < i.length; o++) {
                var n = i[o];
                if (!0 === n.inStaticCanvas && game.doesOverlap(t, n)) {
                    n.inStaticCanvas = !1;
                    var s = game.staticCanvasObjects.indexOf(n);
                    -1 !== s && game.staticCanvasObjects.splice(s, 1)
                }
            }
    }
}
var sawArr = [];
function getSawArr(e, t) {
    if (void 0 !== sawArr[e] && void 0 !== sawArr[e][t])
        return sawArr[e][t]
}
function addSawArr(e, t, a) {
    void 0 === sawArr[e] && (sawArr[e] = []),
    sawArr[e][t] = a
}
function setFillColorByState(e) {
    return e.boostLock ? (e.fillColor = "#600080",
    void (e.fillColorOpacity = .7)) : e.fire ? (e.fillColor = "#ff4000",
    void (e.fillColorOpacity = .7)) : e.poisoned ? (e.fillColor = "#00e600",
    void (e.fillColorOpacity = .5)) : e.infected ? (e.fillColor = "#800000",
    void (e.fillColorOpacity = .7)) : e.grabbed ? (e.fillColor = "grey",
    void (e.fillColorOpacity = .7)) : void delete e.fillColor
}
var startLoadingTime = 0
  , loadingStep = 0
  , lastLoadingPercent = -1;
function updateLoadingProgress() {
    if (!(loadingStep > 0)) {
        var e = parseInt(game.loadedSprites / Object.keys(game.sprites).length * 100);
        e > 100 && (e = 100),
        lastLoadingPercent != e && ($("#loading .loadingText").text(getTranslation("loading_objects") + " (" + e + "%)"),
        1 == pokiEnabled && PokiSDK.gameLoadingProgress({
            percentageDone: e / 100
        }),
        $("#loading .loadingBar .bar").css({
            width: e + "%"
        })),
        lastLoadingPercent = e
    }
}
function loading() {
    $("#forceLandscape").is(":hidden") ? $(".qc-cmp2-consent-info").length > 0 ? setTimeout(loading, 200) : (0 == startLoadingTime && (startLoadingTime = Date.now(),
    loadUserData(!1)),
    0 == Object.keys(game.sprites).length && loadSprites(),
    wasSync ? ($(".loadingText").html(getTranslation("connected_to_server")),
    $("#loading").fadeOut(500),
    reloadImages(),
    console.log("%cStop!", "color: red; font-size:60px"),
    console.log("%cPasting any code may result in data theft. Using scripts is NOT allowed. Your account may be blocked permanently.", "color: red; font-size:20px"),
    lastAutomaticQuality = Date.now(),
    user.premium || "undefined" == typeof ysdk || ysdk.adv.showFullscreenAdv(),
    "poki" == partner && "function" == typeof gdprAds && gdprAds(),
    gameLoop()) : (game.loadedSprites < Object.keys(game.sprites).length || (0 === Object.keys(user).length || 0 === Object.keys(serversList).length ? $("#loading .loadingText").html(lang.loading_data + "...") : "" == connectIp ? ($("#loading .loadingBar .bar").css({
        width: "100%"
    }),
    $("#loading .loadingText").html(lang.searching_server + "..."),
    loadingStep <= 0 && (afterSuccessGetUserData(userDataResult),
    loadingStep++,
    getClosestServer())) : 0 === Object.keys(serversList).length || 0 === Object.keys(user).length || "" === connectIp || gameServer.connected ? wasSync || $("#loading .loadingText").html(getTranslation("waiting_for_server_response") + "...") : (wasSocketInit || (initSocket(),
    1 == pokiEnabled && (PokiSDK.gameLoadingProgress({
        percentageDone: 100
    }),
    PokiSDK.gameLoadingFinished()),
    console.log("Loading time: " + (Date.now() - startLoadingTime) + "ms"),
    null == getCookie("playedGames") && gtag("event", "timing_complete", {
        name: "loadingTime",
        value: Date.now() - startLoadingTime,
        event_category: clientCountry
    }),
    isMobile && ($(window).width() > $(window).height() ? gtag("event", "landscape", {
        event_category: "mobileOrientation"
    }) : gtag("event", "portrait", {
        event_category: "mobileOrientation"
    })),
    setTimeout((function() {
        if (!gameServer.connected && "" != connectIp) {
            $("#loading .loadingInfo").hide();
            var e = document.getElementById("selectServer")
              , t = $(e).clone(!0, !0);
            t.attr("id", "selectServer_clone"),
            $("#loading .loadingInfo").append(getTranslation("connecting_too_long_change_server")),
            $("#loading .loadingInfo").append("<br>"),
            $("#loading .loadingInfo").append(t),
            $("#loading .loadingInfo").fadeIn(2e3)
        }
    }
    ), 5e3)),
    $("#loading .loadingBar .bar").css({
        width: "100%"
    }),
    $("#loading .loadingText").html(getTranslation("connecting_to_server") + "..."))),
    setTimeout(loading, 100))) : setTimeout(loading, 200)
}
function currentName() {
    var e = "";
    return e = void 0 !== game.objectsDef[game.me.name].fullName ? game.objectsDef[game.me.name].fullName : game.me.name,
    void 0 !== lang[e.replace(/ /g, "_").toLowerCase()] ? lang[e.replace(/ /g, "_").toLowerCase()].capitalize() : e.capitalize()
}
function nextName() {
    var e = expTable[game.me.name].next
      , t = "";
    return t = void 0 !== game.objectsDef[e] && void 0 !== game.objectsDef[e].fullName ? game.objectsDef[e].fullName : e,
    void 0 !== lang[t.replace(/ /g, "_").toLowerCase()] ? lang[t.replace(/ /g, "_").toLowerCase()].capitalize() : t.capitalize()
}
var gameZoom = 1
  , drawing = !1;
function draw() {
    gameServer.connected && wasSync && (drawing || (drawing = !0,
    game.hashMap.ready && (automaticQuality(),
    gameZoom < 1 && (gameZoom = 1),
    game.setZoom(gameZoom),
    gameZoom = game.zoom,
    game.clear(),
    game.drawObjects(),
    drawDarkness(),
    function() {
        let e = game.me.positionCenter.x
          , t = 0
          , a = 112e3
          , i = "map.png?v=8";
        e > 114e3 && e < 123500 ? e = 30400 : e >= 123200 && (i = "map_br.png",
        t = 123392,
        a = 16e4);
        mapButtonRotation / 180 % 2 != 0 && ($("#gameContainer > div.minimap > div.line").css("left", "calc(" + (e - t) / (a - t) * 100 + "% - 2px)"),
        $("#gameContainer > div.minimap > img").attr("src") != cdnServer + "images/" + i && $("#gameContainer > div.minimap > img").attr("src", cdnServer + "images/" + i),
        $("#gameContainer > div.minimap").data("fromX", t),
        $("#gameContainer > div.minimap").data("toX", a))
    }(),
    drawing = !1)))
}
var previous = 0
  , lag = 0;
function gameLoop() {
    if (gameServer.connected) {
        var e = Date.now()
          , t = e - previous;
        if (previous = e,
        lag += t,
        game.fps >= gameLoopOPS - 2 && t < 1e3 / (gameLoopOPS - 10))
            lag = 0,
            game.deltaTime = t / 1e3,
            game.update(),
            updateGame();
        else
            for (; lag >= 1e3 / gameLoopOPS; )
                lag > 100 && (lag = 0),
                game.deltaTime = 1e3 / gameLoopOPS / 1e3,
                game.update(),
                updateGame(),
                lag -= 1e3 / gameLoopOPS;
        draw(),
        requestAnimationFrame(gameLoop)
    } else
        setTimeout(gameLoop, 100)
}
"undefined" == typeof console && (console = {});
var limitDarknessTime = 0;
function updateGame() {
    isMobile || mouseMove()
}
function heartbeat() {
    joinedGame && !imDead && gameServer.emit(randomInteger(500, 999))
}
setInterval(heartbeat, 3e4);
var generatedGradients = [];
function generateGradient(e, t, a, i, o) {
    var n = e + "_" + t + "_" + a + "_" + i + "_" + o;
    if (void 0 !== generatedGradients[n])
        return generatedGradients[n];
    var s = document.createElement("canvas")
      , r = s.getContext("2d");
    s.width = e,
    s.height = t;
    var c = r.createRadialGradient(e / 2, t / 2, 0, e / 2, t / 2, o);
    return c.addColorStop(0, a),
    c.addColorStop(1, i),
    r.fillStyle = c,
    r.fillRect(0, 0, s.width, s.height),
    generatedGradients[n] = s,
    s
}
var lastDarknessPercent = 0
  , lastGradient = 0
  , darknessCanvas = document.createElement("canvas")
  , darknessCtx = darknessCanvas.getContext("2d");
function drawDarkness() {
    if (game.me && !imDead) {
        var e = (2250 - game.me.getAllPositions().center.y) / 2250 * 100;
        (e *= 2) < 0 && (e = 0),
        e > 95 && (e = 95);
        var t = 100 - e;
        if (e > 0) {
            let a = 0
              , i = game.me.name;
            "bat" == i || "demonicBat" == i || "madBat" == i || "ghost" == i || "grimReaper" == i || "ghostlyReaper" == i || "pumpkinGhost" == i ? a = 1 : "owl" == i || "snowyOwl" == i ? a = 2 : "duck" != i && "pelican" != i && "seagull" != i || (a = 3),
            1 == a ? e = 0 : 2 == a ? t < 75 && (t = 75) : 3 == a && game.me.inWater && t < 65 && (t = 65)
        }
        if (!(e <= 0)) {
            var a = game.canvas
              , i = game.context;
            lastDarknessPercent = e,
            lastGradient = t,
            t < 15 && (t = 15);
            var o = 2;
            isMobile && (o = 4),
            darknessCanvas.width = a.width / o,
            darknessCanvas.height = a.height / o;
            var n = (e / 25).toFixed(3);
            n > 1 && (n = 1);
            var s = (t / 100).toFixed(3) * game.zoom;
            if (s > 1 && (s = 1),
            void 0 !== game.me) {
                var r = Math.max(game.me.width, game.me.height) / Math.min(game.originalWidth, game.originalHeight) * game.zoom;
                s < r && (s = r)
            }
            darknessCtx.save(),
            darknessCtx.globalAlpha = n,
            darknessCtx.fillStyle = "black",
            darknessCtx.imageSmoothingEnabled = !1,
            darknessCtx.fillRect(0, 0, a.width, a.height),
            darknessCtx.clearRect(floor(darknessCanvas.width / 2 - darknessCanvas.width * s / 2), floor(darknessCanvas.height / 2 - darknessCanvas.height * s / 2), floor(darknessCanvas.width * s), floor(darknessCanvas.height * s)),
            darknessCtx.drawImage(generateGradient(1e3 / o, 1e3 / o, "transparent", "black", 500 / o), 0, 0, 1e3 / o, 1e3 / o, floor(darknessCanvas.width / 2 - darknessCanvas.width * s / 2), floor(darknessCanvas.height / 2 - darknessCanvas.height * s / 2), floor(darknessCanvas.width * s), floor(darknessCanvas.height * s)),
            darknessCtx.restore(),
            darknessCtx.save(),
            darknessCtx.globalCompositeOperation = "destination-out",
            darknessCtx.imageSmoothingEnabled = !1;
            for (var c = 0; c < game.lightPoints.length; c++) {
                var d = game.lightPoints[c]
                  , m = d.light_radius;
                if (d.light_random_radius && (m += randomInteger(0, d.light_random_radius)),
                game.isVisible(game.camera, d, game.originalWidth / 2 + m, game.originalHeight / 2 + m)) {
                    var l = game.getRenderPosition(d.position.x + d.width / 2, d.position.y + d.height / 2);
                    m *= 2,
                    darknessCtx.drawImage(generateGradient(2 * d.light_radius / o, 2 * d.light_radius / o, "black", "transparent", d.light_radius / o), 0, 0, 2 * d.light_radius / o, 2 * d.light_radius / o, (l.x - m / 2 * game.zoom * game.scaleX) / o, (l.y - m / 2 * game.zoom * game.scaleY) / o, m * game.zoom * game.scaleX / o, m * game.zoom * game.scaleY / o)
                }
            }
            darknessCtx.restore(),
            i.save(),
            i.imageSmoothingEnabled = !1,
            i.globalCompositeOperation = "source-over",
            i.drawImage(darknessCanvas, 0, 0, a.width, a.height),
            i.restore()
        }
    }
}
function setAnimations(e) {
    if (e.type == objectType.PLAYER) {
        if ("attacking_left" == e.animation || "attacking_right" == e.animation) {
            if (e.animationFrame % e.animations[e.animation].sprites.length != e.animations[e.animation].sprites.length - 1 || 0 == e.animationFrame)
                return;
            "attacking_right" == e.animation ? e.animation = "flying_right" : "attacking_left" == e.animation && (e.animation = "flying_left")
        }
        ("pigeon" != e.name && "hen" != e.name || "standing_left" != e.animation && "standing_right" != e.animation || e.moveSpeed.y > 1) && (1 == e.flySide ? e.animation = "flying_right" : -1 == e.flySide && (e.animation = "flying_left")),
        e.moveSpeed.y > 1 ? "flying_left" == e.animation || "standing_left" == e.animation ? e.animation = "flapping_left" : "flying_right" != e.animation && "standing_right" != e.animation || (e.animation = "flapping_right") : "flapping_left" == e.animation ? e.animation = "flying_left" : "flapping_right" == e.animation && (e.animation = "flying_right")
    }
}
var mouseActive = !1, lastMousePos = game.getMousePosition(!1), textMsgTimeout;
function mouseMove() {
    if (lastMousePos.x === game.getMousePosition(!1).x && lastMousePos.y === game.getMousePosition(!1).y || (mouseActive = !0,
    lastMousePos = game.getMousePosition(!1)),
    void 0 !== game.me && mouseActive && !imDead && joinedGame) {
        var e = 50;
        emotesMenuOpened && (e = 135),
        game.getMousePosition(!0).x > game.me.getAllPositions().center.x + e ? (1 !== game.me.flySide && gameServer.emit(socketMsgType.FLY, 1),
        game.me.flySide = 1) : game.getMousePosition(!0).x < game.me.getAllPositions().center.x - e ? (-1 !== game.me.flySide && gameServer.emit(socketMsgType.FLY, -1),
        game.me.flySide = -1) : (0 !== game.me.flySide && gameServer.emit(socketMsgType.FLY, 0),
        game.me.flySide = 0)
    }
}
function gameClick() {
    scanPlayersOpened && ($("#scanPlayers").hide(),
    scanPlayersOpened = !1)
}
function boost() {
    isMobile && fullScreen(),
    void 0 !== game.me && !imDead && joinedGame && gameServer.emit(socketMsgType.BOOST)
}
function textMsg(e, t, a) {
    void 0 === a && (a = 8e3),
    $("#gameContainer > div.textMsg").css({
        color: t
    }).html(e).show(),
    clearTimeout(textMsgTimeout),
    textMsgTimeout = setTimeout((function() {
        $("#gameContainer > div.textMsg").fadeOut(2e3)
    }
    ), a)
}
var boostTimelock = 0;
function doBoost(e) {
    e.moveable && (0 == e.inHide ? game.time - boostTimelock > 100 && (boostTimelock = game.time,
    e.moveSpeed.y < 0 && (e.moveSpeed.y = 0),
    e.moveSpeed.y += 300,
    e.moveSpeed.y > 600 && (e.moveSpeed.y = 600)) : game.time - e.inHideTime > 400 && (e.inHide = !1))
}
game.canvas.onmousedown = function(e) {
    3 == e.which && skillUse()
}
,
game.canvas.onmouseup = function(e) {
    3 == e.which && skillStop()
}
;
var usingSkill = !1, skillReleaseTimer;
function skillUse() {
    clearTimeout(skillReleaseTimer),
    void 0 !== game.me && !imDead && joinedGame && void 0 !== game.me.skill && game.me.skill.active && (usingSkill || (gameServer.emit(socketMsgType.SKILL, !0),
    usingSkill = !0))
}
function skillStop() {
    clearTimeout(skillReleaseTimer),
    skillReleaseTimer = setTimeout((function() {
        usingSkill && (gameServer.emit(socketMsgType.SKILL, !1),
        usingSkill = !1)
    }
    ), 150)
}
game.canvas.addEventListener("click", gameClick, !1),
isMobile || (game.canvas.addEventListener("click", boost, !1),
game.canvas.addEventListener("wheel", (function() {
    if (joinedGame && "undefined" != typeof event) {
        var e = .1;
        event.deltaY > 0 && (e *= -1),
        gameZoom += e,
        gameZoom = Math.round(100 * gameZoom) / 100,
        event.preventDefault()
    }
}
))),
window.addEventListener("keydown", keysPressed, !1),
window.addEventListener("keyup", keysReleased, !1);
var keys = []
  , emotesMenuOpenedByTab = !1;
function keysPressed(e) {
    if (27 == e.keyCode || emotesMenuOpenedByTab && (37 == e.keyCode || 38 == e.keyCode || 39 == e.keyCode) || "text" != document.activeElement.type && "textarea" != document.activeElement.type) {
        if (keys[e.keyCode] = !0,
        13 == e.keyCode && Date.now() - lastEmoteChatTime > 100 && (emotesMenuOpened ? (hideEmotesMenu(),
        emotesMenuOpenedByTab = !1) : (showEmotesMenu(),
        emotesMenuOpenedByTab = !1)),
        9 == e.keyCode && ($("#chat-box").is(":visible") || Date.now() - lastEmoteChatTime > 100 && (emotesMenuOpened ? emotesMenuOpenedByTab && (emotesMenuOpenedByTab = !1,
        hideEmotesMenu()) : (emotesMenuOpenedByTab = !0,
        showEmotesMenu(),
        emotesMenuOpened && $(chatInput).is(":visible") && $(chatInput).find("input").focus()))),
        27 == e.keyCode)
            emotesMenuOpened && hideEmotesMenu();
        else {
            if (116 == (e.which || e.keyCode))
                return void e.preventDefault();
            if (32 == e.keyCode)
                return void skillUse();
            if (77 == e.keyCode && joinedGame)
                return hideShowMap(),
                void e.preventDefault()
        }
        keysAction()
    }
}
function keysReleased(e) {
    keys[e.keyCode] = !1,
    32 == e.keyCode && skillStop(),
    keysAction()
}
var boostReleased = !0
  , attackReleased = !0;
function keysAction() {
    void 0 !== game.me && !imDead && joinedGame && (keys[37] || keys[65] ? (-1 !== game.me.flySide && gameServer.emit(socketMsgType.FLY, -1),
    game.me.flySide = -1,
    mouseActive = !1) : keys[39] || keys[68] ? (1 !== game.me.flySide && gameServer.emit(socketMsgType.FLY, 1),
    game.me.flySide = 1,
    mouseActive = !1) : mouseActive || (0 !== game.me.flySide && gameServer.emit(socketMsgType.FLY, 0),
    game.me.flySide = 0),
    keys[38] || keys[87] ? (boostReleased && (boost(),
    boostReleased = !1),
    mouseActive = !1) : boostReleased = !0)
}
function resize(e) {
    "text" != document.activeElement.type && "textarea" != document.activeElement.type && setTimeout((function() {
        .5625 * window.innerWidth > window.innerHeight ? (game.canvas.style.width = window.innerWidth + "px",
        game.canvas.style.height = .5625 * window.innerWidth + "px",
        game.canvas.style.marginTop = (window.innerHeight - .5625 * window.innerWidth) / 2 + "px",
        game.canvas.style.marginLeft = 0) : .5625 * window.innerWidth <= window.innerHeight && (game.canvas.style.width = window.innerHeight / .5625 + "px",
        game.canvas.style.height = window.innerHeight + "px",
        game.canvas.style.marginLeft = (window.innerWidth - window.innerHeight / .5625) / 2 + "px",
        game.canvas.style.marginTop = 0),
        isMobile && joinedGame && ($("#gameContainer > div.mobileControls").css({
            top: "calc(" + window.innerHeight + "px - 15vw)"
        }),
        window.scrollTo(0, 0)),
        !0 !== e && emotesMenuOpened && hideEmotesMenu(),
        setQuality(gameQuality)
    }
    ), 50)
}
function refreshYouEat(e) {
    if (void 0 !== foodChain[e] && game.objectsDef[e].type == objectType.PLAYER) {
        for (var t = "", a = Object.keys(foodChain[e].eats), i = 0; i < a.length; i++) {
            var o = game.objectsDef[a[i]].animation
              , n = game.objectsDef[a[i]].animations[o].sprites[0]
              , s = game.sprites[n]
              , r = foodChain[e].eats[a[i]].exp
              , c = trimImageBackground(s)
              , d = 0;
            startBonus && (d = 30),
            isMobile ? t += "<div class='item' data-exp='" + r + "'><img crossorigin='anonymous' src='" + c + "'></div>" : (void 0 !== user.bonusExp && (r = parseInt(r * (1 + (user.bonusExp + d) / 100))),
            t += "<div class='item' data-exp='" + r + "'><div class='info'><span>" + r + " EXP</span></div><img crossorigin='anonymous' src='" + c + "'></div>")
        }
        $("#gameContainer > div.status div.youEat div.food").html(t);
        var m = $("#gameContainer > div.status div.youEat div.food .item");
        m.sort((function(e, t) {
            return +$(e).data("exp") - +$(t).data("exp")
        }
        )),
        m.appendTo("#gameContainer > div.status div.youEat div.food"),
        "grimReaper" != e && "pumpkinGhost" != e && "ghostlyReaper" != e || $("#gameContainer > div.status div.youEat div.food").html(lang.all_living_creatures_skill)
    }
    if (game.objectsDef[e].type == objectType.PLAYER && void 0 !== game.objectsDef[e].skill) {
        var l = game.objectsDef[e].skill;
        $("#gameContainer > div.status div.skillRight").css("background-image", "url(" + imageToBase64(game.sprites[l.icon]) + ")"),
        l.active ? (skillType = lang.active_full,
        isMobile && (skillType = lang.active),
        $("#skillButton").show(),
        $("#skillButton").css("background-image", "url(" + imageToBase64(game.sprites[l.icon]) + ")"),
        $("#gameContainer > div.status div.skillRight .rclick").show()) : (skillType = lang.passive,
        $("#skillButton").hide(),
        $("#gameContainer > div.status div.skillRight .rclick").hide()),
        imDead && $("#skillButton").hide();
        var g = "";
        void 0 !== l.cooldown && (g = lang.cooldown_time + ": " + l.cooldown / 1e3 + "s<br>");
        var p = getTranslation("skill_" + l.fullName.replace(/ /g, "_"))
          , u = [];
        void 0 !== l.params && (u = l.params);
        var v = getTranslation("skill_" + l.fullName.replace(/ /g, "_") + "_description", u);
        $("#gameContainer > div.status .skillRightDescription").html(lang.skill_name + ": " + p.capitalize() + "<br>" + lang.type + ": " + skillType + "<br>" + g + lang.description + ": " + v)
    }
}
function refreshSkinChanger() {
    if ($("#gameContainer > div.skinChanger").hide(),
    $("#gameContainer > div.skinChanger").empty(),
    $("#gameContainer > div.skinChangerButton").hide(),
    "undefined" == typeof user || void 0 === user.skins)
        return;
    if (user.skins.length > 0)
        for (var e = user.skins.split(";"), t = 0; t < e.length; t++) {
            if ((g = (l = e[t].split(","))[0]) == game.me.name) {
                $("#gameContainer > .skinChangerButton").css("display", "inline-table").html('<img crossorigin="anonymous" src="' + cdnServer + "images/skinChange_" + game.me.name + '.png">');
                var a = g;
                if (void 0 === a)
                    return !0;
                var i = game.objectsDef[a].animation
                  , o = game.objectsDef[a].animations[i].sprites[0]
                  , n = game.sprites[o];
                if (n instanceof HTMLCanvasElement) {
                    void 0 === n.toURL && (n.toURL = n.toDataURL());
                    var s = n.toURL
                } else if (-1 !== n.src.indexOf("blob:")) {
                    var r = document.createElement("canvas");
                    r.width = n.width,
                    r.height = n.height,
                    r.getContext("2d").drawImage(n, 0, 0);
                    var c = r.toDataURL("image/png");
                    s = c,
                    n.toURL = c
                } else
                    s = n.src;
                $("#gameContainer > div.skinChanger").append('<img crossorigin="anonymous" src="' + s + '" onClick="selectSkin(this); $(\'.skinChanger\').hide();" data-skin="' + g + '" data-skin-id=0>');
                for (var d = 1; d < l.length; d++) {
                    s = $('.offer.skin[data-skin="' + g + '"][data-skin-id="' + l[d] + '"] .sprite-image').attr("src");
                    $("#gameContainer > div.skinChanger").append('<img crossorigin="anonymous" class="drag-item" draggable="true" src="' + s + '" onClick="selectSkin(this); $(\'.skinChanger\').hide();" data-skin="' + g + '" data-skin-id=' + l[d] + ">")
                }
            }
        }
    let m = localStorage.getItem("customOrder_" + user.id + "_skinChanger");
    if (m && (m = JSON.parse(m),
    $("#gameContainer > div.skinChanger").html($("#gameContainer > div.skinChanger").children().sort((function(e, t) {
        return m.indexOf($(e).data("skin-id")) - m.indexOf($(t).data("skin-id"))
    }
    )))),
    $("#gameContainer > div.petChanger").hide(),
    $("#gameContainer > div.petChanger").empty(),
    $("#gameContainer > div.petChangerButton").hide(),
    user.skins.length > 0 && user.premium)
        for (e = user.skins.split(";"),
        t = 0; t < e.length; t++) {
            var l, g;
            if ("pets" == (g = (l = e[t].split(","))[0])) {
                $("#gameContainer > .petChangerButton").css("display", "inline-table"),
                $("#gameContainer > div.petChanger").append('<img crossorigin="anonymous" src="' + cdnServer + 'images/red-cross.png" onClick="selectSkin(this); $(\'.petChanger\').hide();" style="cursor:pointer; color:red; pointer-events:auto" data-skin="' + g + '" data-skin-id=0>');
                for (d = 1; d < l.length; d++) {
                    s = $('.offer.skin[data-skin="' + g + '"][data-skin-id="' + l[d] + '"] .sprite-image').attr("src");
                    $("#gameContainer > div.petChanger").append('<img crossorigin="anonymous" class="drag-item" draggable="true" src="' + s + '" onClick="selectSkin(this); $(\'.petChanger\').hide();" data-skin="' + g + '" data-skin-id=' + l[d] + ">")
                }
            }
        }
    let p = localStorage.getItem("customOrder_" + user.id + "_petChanger");
    p && (p = JSON.parse(p),
    $("#gameContainer > div.petChanger").html($("#gameContainer > div.petChanger").children().sort((function(e, t) {
        return p.indexOf($(e).data("skin-id")) - p.indexOf($(t).data("skin-id"))
    }
    ))))
}
window.addEventListener("resize", resize),
resize(!0),
setInterval((function() {
    resize(!0)
}
), 1e3);
var lastFps = 0;
setInterval((function() {
    var e = game.fps;
    if (abs(e - game.gameLoopOPS) <= 1 && (e = game.gameLoopOPS),
    e < 15)
        var t = "red";
    else if (e < 24)
        t = "#ff8000";
    else
        t = "green";
    lastFps != e && $("#gameContainer > div.debugInfo > div.fps").html('<font color="' + t + '">' + e + " fps</font>"),
    lastFps = e
}
), 1e3),
"undefined" != typeof christmasTime && christmasTime && (31 == (new Date).getDate() && 11 == (new Date).getMonth() || 1 == (new Date).getDate() && 0 == (new Date).getMonth() && 0 == (new Date).getHours() && (new Date).getMinutes() < 2) && setInterval((function() {
    if (!(document.hidden || game.fps < 24)) {
        var e = new Date;
        if (31 == e.getDate() && 11 == e.getMonth() && 23 == e.getHours() && 59 == e.getMinutes() && e.getSeconds() >= 30)
            textMsg("&#x2757;" + (60 - e.getSeconds()) + "&#x2757;", "#ff1a1a", 1e3);
        else if (1 == e.getDate() && 0 == e.getMonth() && 0 == e.getHours() && e.getMinutes() < 2) {
            for (var t = randomInteger(2, 4), a = 0; a < t; a++) {
                if (1 == randomInteger(1, 2))
                    var i = game.newObject(game.objectsDef.fireworks);
                else
                    i = game.newObject(game.objectsDef.fireworks_double);
                i.id = null,
                i.light = !1,
                i.animation = "standard",
                i.position.x = game.camera.position.x - i.width / 2 - game.originalWidth / 2 + randomInteger(0, game.originalWidth),
                i.position.y = game.camera.position.y - i.height / 2 - game.originalHeight / 2 + randomInteger(0, game.originalHeight),
                i.position.y < 2304 || (i.position.x < 0 || i.position.x + i.width >= 112e3 || i.position.y + i.height >= game.map.height || game.addObject(i))
            }
            textMsg("&#127881;" + lang.happy_new_year + "&#127881;", "#ffff00", 1e3)
        }
    }
}
), 250);
var leaderboard = []
  , lastLeaderboardHTML = "";
function refreshLeaderboard(e) {
    e.leaderboard = e.a,
    e.yourPlace = e.b;
    var t = e.leaderboard
      , a = "";
    leaderboard = e.leaderboard;
    for (var i = 0; i < t.length; i++) {
        var o = t[i].nick;
        i + 1 != e.yourPlace || imDead || (o = '<font color="#1466b8">' + o + "</font>"),
        a += '<div style="display:grid; grid-template-columns:14px 1fr auto; align-items:center; width:100%; gap:4px;">',
        a += i < 3 ? "<div><img crossorigin='anonymous' src='" + cdnServer + "images/star" + (i + 1) + ".png'></div>" : "<div style='color:#007490;font-weight:bold;text-align:center'>" + (i + 1) + ".</div>",
        a += "<div style='overflow:hidden;white-space:nowrap;text-overflow:ellipsis; padding:0 2px; text-align:left;'>" + o + "</div>",
        a += "<div style='text-align:right;color:orange;font-weight:bold; white-space:nowrap;'>" + t[i].score + "</div>",
        a += "</div>"
    }
    void 0 !== e.yourPlace && e.yourPlace > 10 && !imDead && null != myExperience && (a += "<div style=\"display:grid; grid-template-columns:17px 1fr auto; align-items:center; width:100%; gap:4px; padding:2px 0;\"><div style='color:#007490;font-weight:bold;'>" + e.yourPlace + ".</div><div style='overflow:hidden;white-space:nowrap;text-overflow:ellipsis; padding:0 2px; text-align:left;color:#1466b8;'>" + name + "</div><div style='text-align:right;color:orange;font-weight:bold; white-space:nowrap;'>" + myExperience + "</div></div>"),
    lastLeaderboardHTML != a && ($("#gameContainer > div.leaderboard > span.players").html(a),
    lastLeaderboardHTML = a)
}
var joinedGame = !1, name;
function join() {
    if (!joinedGame) {
        if ($("#friends").css({
            bottom: "4px",
            opacity: "0.95"
        }),
        $("#chat-box").css({
            bottom: "4px",
            opacity: "0.95"
        }),
        $("#open-friends-icon").css({
            bottom: "10px",
            opacity: "0.65"
        }),
        $(".qc-cmp2-persistent-link").remove(),
        joinedGame = !0,
        gameServer.emit("game:join", {
            nick: name,
            saveKey: saveKey,
            version: version,
            adblockDisabled: adblockDisabled,
            userData: user,
            startBonus: startBonus,
            startCharacter: user.startPoints > 0 || buyStartCharacter ? startCharacter : 0,
            buyStartCharacter: buyStartCharacter
        }),
        friendsData && friendsData.ids && friendsData.token && gameServer.emit("game:friends", friendsData),
        buyStartCharacter = !1,
        1 == pokiEnabled && (PokiSDK.gameplayStart(),
        "poki" == partner)) {
            var e = document.getElementById("ac1");
            PokiSDK.destroyAd(e);
            e = document.getElementById("ac2");
            PokiSDK.destroyAd(e)
        }
        "undefined" != typeof CrazyGames && window.CrazyGames.SDK.game.gameplayStart();
        var t = $("#skins").css("display", "none").detach();
        $("#gameContainer").append(t);
        var a = $("#pets").css("display", "none").detach();
        $("#gameContainer").append(a),
        $("#uiContainer").remove(),
        $("#loading").remove(),
        $("#gameContainer").css("display", "block"),
        $("#gameContainer").animate({
            opacity: 1
        }, 1e3),
        "poki" != partner && (window.onbeforeunload = confirmExit),
        gtag("event", "join", {
            event_category: "play"
        }),
        setTimeout((function() {
            var e = "desktop";
            isMobile && (e = "mobile");
            var t = game.fps;
            t > 60 && (t = 60),
            gtag("event", e, {
                event_category: "fps",
                event_label: qualityMode,
                value: t
            })
        }
        ), 9e4),
        user.guest || setCookie("playname", name, 31),
        null == getCookie("playedGames") ? setCookie("playedGames", 1, 3650) : setCookie("playedGames", parseInt(getCookie("playedGames")) + 1, 3650),
        parseInt(getCookie("playedGames")) <= 2 && (setTimeout((function() {
            $(".skillRight .arrow").fadeIn(1e3)
        }
        ), 5e3),
        $(".guide").show()),
        joinTime = Date.now(),
        startBonus && textMsg(lang.bonus_activated, "green", 5e3),
        setTimeout((function() {
            2 == $(".skillRight").parent().find("img,span").length && ($(".skillRight").parent().find("img,span").remove(),
            alert("Unauthorized script found. Do not use it, otherwise your account may be banned."))
        }
        ), 1e4),
        user.guest ? $("#open-friends-icon").remove() : isMobile && $("#open-friends-icon").appendTo("#gameContainer > div.mobileControls"),
        closeFriends()
    }
}
var myGemsAmount = null
  , myRevivalTokensAmount = null;
function endGameText(e, t, a, i, o, n) {
    $(".mobileControls").hide(),
    $("#ac3").css({
        display: "none"
    }),
    myGemsAmount = null,
    o > 0 && i > 0 && setTimeout((function() {
        getUserRevivalTokens((function(e) {
            myGemsAmount = e.gems,
            myRevivalTokensAmount = e.tokens,
            console.log("Gems: " + myGemsAmount + " tokens: " + myRevivalTokensAmount)
        }
        ))
    }
    ), 1e3),
    killerText = e,
    "string" == typeof lang[killerText.replace(/ /g, "_").toLowerCase()] && (killerText = lang[killerText.replace(/ /g, "_").toLowerCase()].toLowerCase()),
    $(".endGameText").html(getTranslation("you_killed_by", [killerText]) + '<br><span style="font-size:50%">' + getTranslation("you_will_spawn_with", [t]) + "</span>"),
    $(".endGame").css("opacity", 1),
    $(".endGame").fadeIn().css({
        top: -100,
        position: "absolute",
        opacity: 1
    }).animate({
        top: "40%"
    }, 1800),
    $(".btnPlayAgain").css({
        display: "inline",
        opacity: 0
    }),
    $(".btnPlayAgain").css("pointer-events", "none"),
    $(".revivalInfo").css({
        display: "block",
        opacity: 0
    }),
    $(".btnRevival").css({
        display: "inline",
        opacity: 0
    }),
    $(".btnRevival").css("pointer-events", "none"),
    (o <= 0 || i <= 0) && $(".btnRevival").css("display", "none"),
    setTimeout((function() {
        if (1 != user.premium) {
            if ($("#ac3").css({
                display: "block"
            }),
            !isMobile || "" != partner && "xiaomi" != partner ? $(window).width() >= 970 && $(window).height() >= 720 ? ($("#ac3").css({
                width: "970px",
                height: "250px"
            }),
            1 == pokiEnabled && "poki" == partner && PokiSDK.displayAd(document.getElementById("ac3"), "970x250"),
            console.log("Displaying ad 970x250")) : $(window).width() >= 728 && $(window).height() >= 360 ? ($("#ac3").css({
                width: "728px",
                height: "90px"
            }),
            1 == pokiEnabled && "poki" == partner && PokiSDK.displayAd(document.getElementById("ac3"), "728x90"),
            console.log("Displaying ad 728x90")) : $(window).width() >= 400 && $(window).height() >= 300 && ($("#ac3").css({
                width: "320px",
                height: "50px"
            }),
            1 == pokiEnabled && "poki" == partner && PokiSDK.displayAd(document.getElementById("ac3"), "320x50"),
            console.log("Displaying ad 320x50")) : $("#ac3").css({
                width: "100%",
                height: "25vh",
                "margin-top": 25
            }),
            "" == partner ? $("#ac3").html('<ins class="adsbygoogle" style="display:block; width:100%; height:100%;" data-ad-client="ca-pub-1691583331684279" data-ad-slot="1277347679"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script>') : "xiaomi" == partner && $("#ac3").html('<ins class="adsbygoogle" style="display:block; width:100%; height:100%;" data-ad-client="ca-pub-7151632855683728" data-ad-slot="3867077255"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script>'),
            "undefined" != typeof CrazyGames)
                try {
                    window.CrazyGames.SDK.banner.clearBanner("ac3"),
                    window.CrazyGames.SDK.banner.requestResponsiveBanner(["ac3"])
                } catch (e) {}
            "undefined" != typeof gdsdk && window.gdsdk.showAd(window.gdsdk.AdType.Display, {
                containerId: "ac3"
            }).then(( () => console.info("showAd(window.gdsdk.AdType.Display) resolved."))).catch((e => console.info(e))),
            setTimeout((function() {
                $(".btnPlayAgain").css("pointer-events", "auto"),
                $(".btnPlayAgain").animate({
                    opacity: 1
                }, 1500),
                showRevivalButton(i, o, n)
            }
            ), 2e3)
        } else
            $(".btnPlayAgain").css("pointer-events", "auto"),
            $(".btnPlayAgain").animate({
                opacity: 1
            }, 1500),
            showRevivalButton(i, o, n);
        setTimeout((function() {
            !function() {
                var e = null
                  , t = !1
                  , a = 5e3
                  , i = {
                    passive: !0
                }
                  , o = $(".endGame");
                function n() {
                    clearTimeout(e),
                    o.is(":visible") && (e = setTimeout((function() {
                        o.css("opacity", 0),
                        setTimeout((function() {
                            o.css("display", "none"),
                            t = !0
                        }
                        ), 1e3)
                    }
                    ), a))
                }
                function s() {
                    !1 !== window.imDead ? (t && (o.css({
                        display: "block",
                        opacity: 1
                    }),
                    t = !1),
                    n()) : window.__endGameCleanup__()
                }
                window.__endGameCleanup__ = function() {
                    clearTimeout(e),
                    ["mousemove", "mousedown", "touchstart", "wheel", "pointermove"].forEach((function(e) {
                        window.removeEventListener(e, s, i)
                    }
                    ))
                }
                ,
                n(),
                ["mousemove", "mousedown", "touchstart", "wheel", "pointermove"].forEach((function(e) {
                    window.addEventListener(e, s, i)
                }
                ))
            }()
        }
        ), 2e3)
    }
    ), 2e3)
}
function showRevivalButton(e, t, a) {
    if (e <= 0 || t <= 0)
        return void $(".btnRevival").css({
            display: "none"
        });
    if (null == myGemsAmount)
        return void setTimeout((function() {
            showRevivalButton(e, t, a)
        }
        ), 1e3);
    let i = "red"
      , o = "red";
    myGemsAmount >= e && (i = "#50ff00"),
    myRevivalTokensAmount >= t && (o = "#50ff00"),
    $(".btnRevival").html("<img data-cdn-load='images/shop/revival_token.png'> " + lang.revival + " <img data-cdn-load='images/shop/revival_token.png'>"),
    $(".btnRevival").attr("onclick", "playAgain(1)"),
    myRevivalTokensAmount < t && myGemsAmount >= e && ($(".btnRevival").html("<img data-cdn-load='images/shop/gem.png'> " + lang.revival + " <img data-cdn-load='images/shop/gem.png'>"),
    $(".btnRevival").attr("onclick", "playAgain(2)")),
    $(".revivalInfo").html(getTranslation("revival_cost", t) + " <img data-cdn-load='images/shop/revival_token.png'> " + lang.or + " " + e + " <img data-cdn-load='images/shop/gem.png'><br>" + getTranslation("you_have_x", "") + "<span style='color:" + o + "'>" + myRevivalTokensAmount + "</span> <img data-cdn-load='images/shop/revival_token.png'> " + lang.and + " <span style='color:" + i + "'>" + myGemsAmount + "</span> <img data-cdn-load='images/shop/gem.png'><br>" + getTranslation("exp_with_revival", a)),
    myGemsAmount >= e || myRevivalTokensAmount >= t ? $(".btnRevival").css({
        "pointer-events": "auto",
        "background-color": "#50ff00"
    }) : $(".btnRevival").css({
        "pointer-events": "none",
        "background-color": "#3c3c3c"
    }),
    (e > 0 || t > 0) && (myGemsAmount >= e || myRevivalTokensAmount >= t ? $(".btnRevival").animate({
        opacity: 1
    }, 1500) : $(".btnRevival").animate({
        opacity: .5
    }, 1500),
    $(".revivalInfo").animate({
        opacity: 1
    }, 1500)),
    loadCdnImages()
}
var prerollFunction = function() {
    console.log("adFinished"),
    lastDrawnExperience = 0,
    gameServer.emit("game:join", {
        nick: name,
        saveKey: saveKey,
        version: version,
        adblockDisabled: adblockDisabled,
        userData: user,
        startBonus: startBonus,
        mode: playAgainMode
    }),
    playAgainMode = 0,
    1 == pokiEnabled && PokiSDK.gameplayStart(),
    "undefined" != typeof crazysdk && crazysdk.gameplayStart()
}
  , wasVideoAd = !1
  , playAgainMode = 0;
function playAgain(e) {
    if (playAgainMode = void 0 !== e ? e : 0,
    "poki" == partner) {
        var t = document.getElementById("ac3");
        null != t && PokiSDK.destroyAd(t)
    }
    isMobile && $(".mobileControls").show(),
    $(".endGame").css("display", "none"),
    $(".btnPlayAgain").css("display", "none"),
    $(".btnPlayAgain").css("opacity", "0"),
    $(".btnRevival").css("display", "none"),
    $(".btnRevival").css("opacity", "0"),
    $(".revivalInfo").css("display", "none"),
    $(".revivalInfo").css("opacity", "0"),
    "poki" != partner && (window.onbeforeunload = confirmExit),
    user.premium || 1 != pokiEnabled ? user.premium || "undefined" == typeof CrazyGames ? user.premium || "undefined" == typeof gdsdk || "undefined" === gdsdk.showAd ? (lastDrawnExperience = 0,
    gameServer.emit("game:join", {
        nick: name,
        saveKey: saveKey,
        version: version,
        adblockDisabled: adblockDisabled,
        userData: user,
        startBonus: startBonus,
        mode: playAgainMode
    })) : setTimeout((function() {
        gdsdk.showAd()
    }
    ), 1e3) : setTimeout((function() {
        const e = {
            adFinished: () => prerollFunction(),
            adError: e => {
                prerollFunction(),
                console.log("Error midgame ad", e)
            }
        };
        window.CrazyGames.SDK.ad.requestAd("midgame", e)
    }
    ), 1e3) : setTimeout((function() {
        PokiSDK.commercialBreak().then(prerollFunction)
    }
    ), 1e3),
    gtag("event", "again", {
        event_category: "play"
    })
}
function confirmExit() {
    return lang.leave_page_warning
}
function removeEmojis(e) {
    return e.replace(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g, "")
}
$(".selectServer").on("change", (function(e) {
    var t = this.value;
    if (void 0 !== gameServer && void 0 !== gameServer.io && void 0 !== gameServer.io.uri && gameServer.io.uri != t) {
        var a = $(".selectServer option[value='" + t + "']").html();
        $(".selectServer option[value='" + t + "']").html(lang.connecting_to_server + "..."),
        $("#canvasGame").fadeOut(),
        connectIp = t,
        wasSocketInit = !1,
        gameServer.disconnect(),
        initSocket();
        var i = setInterval((function() {
            if (gameServer.connected || $(".selectServer").val() != t) {
                var e = $(".selectServer").css("color");
                $(".selectServer").css({
                    color: "#00d600"
                }),
                $(".selectServer option[value='" + t + "']").html(lang.connected_to_server),
                setTimeout((function() {
                    $(".selectServer option[value='" + t + "']").html(a),
                    $(".selectServer").css({
                        color: e
                    })
                }
                ), 1e3),
                clearInterval(i)
            }
        }
        ), 250)
    }
}
)),
$(".skillRight").hover((function() {
    $(".skillRightDescription").fadeIn(500),
    $(".skillRight .arrow").fadeOut(1e3)
}
), (function() {
    $(".skillRightDescription").css("display", "none")
}
));
var imBlocked = 0;
setInterval((function() {
    void 0 !== game.me && !imDead && joinedGame && (game.me.groundedTop && game.me.groundedBottom || game.me.groundedLeft && game.me.groundedRight)
}
), 1e3);
var emotesMenuOpened = !1
  , lastEmotesMenuOpenedTime = 0;
game.canvas.onauxclick = function(e) {
    !e || 2 != e.which && 4 != e.button || (emotesMenuOpened ? (hideEmotesMenu(),
    emotesMenuOpenedByTab = !1) : (showEmotesMenu(),
    emotesMenuOpenedByTab = !1))
}
;
var typing = !1;
setInterval((function() {
    let e = !1;
    emotesMenuOpened && friendsData && friendsData.ids && friendsData.token && ("" != $(chatInput).find("input").val() && (e = !0),
    isMobile && $(chatInput).find("input").is(":focus") && (e = !0)),
    e != typing && (gameServer.emit(socketMsgType.TYPING, {
        typing: e
    }),
    typing = e)
}
), 100),
$(document).keydown((function(e) {
    if (9 == e.keyCode) {
        if (!joinedGame)
            return;
        "text" == document.activeElement.type || "textarea" == document.activeElement.type ? document.activeElement.blur() : $("#chat-box").is(":visible") ? $("#chat-box").find("input").focus() : !emotesMenuOpenedByTab && emotesMenuOpened && $(chatInput).is(":visible") && $(chatInput).find("input").focus(),
        e.preventDefault()
    }
}
));
var chatDisabled = !1;
function showEmotesMenu() {
    if (!(1 == game.me.inBattleRoyaleZone && 1 != game.me.userId || chatDisabled || scanPlayersOpened || imDead || !joinedGame || Date.now() - joinTime < 1e3 || Date.now() - lastEmotesMenuOpenedTime < 1e3)) {
        $($(".wheel-button").attr("href")).showIcon($(".wheel-button"), {
            animation: "fade",
            animationSpeed: [0, 250],
            angle: [0, 360]
        }),
        $("#chatmenu").finish().fadeIn(),
        $("#scan-players-icon").fadeIn(),
        isMobile || shortcutsManager.show(),
        emotesMenuOpened = !0,
        lastEmotesMenuOpenedTime = Date.now(),
        $(".chatmenu [data-chat-id='49']").text(getTranslation("chat_49", mySkinsCount));
        Object.keys(friendsArr).length >= 1 || isFriendOnScreen || user.access >= 100 ? ($(chatInput).show(),
        isMobile || (emotesMenuOpenedByTab ? $(chatInput).find("input").attr("placeholder", "") : $(chatInput).find("input").attr("placeholder", getTranslation("press_tab"))),
        isMobile && ($(chatInput).css({
            top: "145px",
            left: "70px",
            width: "120px"
        }),
        $(chatInput).find("input").css({
            width: "90px"
        }),
        $(chatInput).find(".info").css({
            fontSize: "8px"
        }))) : $(chatInput).hide()
    }
}
function hideEmotesMenu() {
    $(chatInput).find("input").blur(),
    $($(".wheel-button").attr("href")).hideIcon($(".wheel-button"), {
        animation: "fade",
        animationSpeed: [0, 500],
        angle: [0, 360]
    }),
    $("#chatmenu").finish().fadeOut(),
    $("#scan-players-icon").fadeOut(),
    shortcutsManager.hide(),
    emotesMenuOpened = !1
}
var lastEmoteChatTime = 0;
function sendEmote(e) {
    Date.now() - lastEmoteChatTime < 500 || (lastEmoteChatTime = Date.now(),
    null == shortcutsManager.changingKey ? (gameServer.emit(socketMsgType.EMOTE, {
        emoteId: e
    }),
    hideEmotesMenu()) : shortcutsManager.setKeyAction({
        action: "sendEmote",
        emoteId: e
    }))
}
function sendChat(e) {
    Date.now() - lastEmoteChatTime < 500 || (lastEmoteChatTime = Date.now(),
    null == shortcutsManager.changingKey ? (gameServer.emit(socketMsgType.CHAT, {
        chatId: e
    }),
    hideEmotesMenu()) : shortcutsManager.setKeyAction({
        action: "sendChat",
        chatId: e
    }))
}
var chatInput = document.getElementById("chatinput");
$(chatInput).find("input").on("keydown", (function(e) {
    (!emotesMenuOpenedByTab || 37 != e.keyCode && 38 != e.keyCode && 39 != e.keyCode || e.preventDefault(),
    13 == e.keyCode) && (sendChat("text_" + $(this).val()),
    $(this).val(""))
}
)),
$(chatInput).find("button").on("click", (function(e) {
    sendChat("text_" + $(chatInput).find("input").val()),
    $(chatInput).find("input").val("")
}
));
var decodeHTML = function(e) {
    var t = document.createElement("textarea");
    return t.innerHTML = e,
    t.value
};
function stickMessageToObject(e) {
    if (chatDisabled)
        return;
    let t = e.message;
    e.lastMessageId = e.lastMessageId || 0,
    e.lastMessageId >= t.id || (e.lastMessageId = t.id,
    1 == t.type ? stickEmoteToObject(e, t.parm, t.lifetime) : 2 != t.type && 3 != t.type || stickChatToObject(e, t.parm, t.lifetime, t.parm2))
}
function addItemToLootInfo(e, t) {
    var a = new Image;
    a.crossOrigin = "Anonymous",
    a.src = cdnServer + "sprites/loot-items/" + t.name + ".png",
    a.onload = function() {
        e.lootInfo = e.lootInfo || [];
        for (var i = 0; i < e.lootInfo.length; i++)
            if (e.lootInfo[i].name == t.name)
                return e.lootInfo[i].amount += t.amount,
                void (e.lootInfo[i].startTime = game.time);
        e.lootInfo.push({
            name: t.name,
            amount: t.amount,
            startTime: game.time,
            image: a
        })
    }
}
function stickEmoteToObject(e, t, a) {
    var i = new Image;
    i.crossOrigin = "Anonymous",
    i.src = cdnServer + "emotes/" + t + ".png",
    i.onload = function() {
        e.emote = i,
        e.emoteStartTime = game.time - a,
        t < 1e3 && e.pet && (e.pet.emote = i,
        e.pet.emoteStartTime = game.time + 600 - a),
        delete e.chat
    }
}
function stickChatToObject(e, t, a, i) {
    if ("string" == typeof t && 0 == t.indexOf("text_")) {
        var o = t.slice(5);
        return " " == o.charAt(0) && (o = o.substring(1)),
        " " == o.charAt(o.length - 1) && (o = o.substring(0, o.length - 1)),
        e.chat = o,
        e.chatStartTime = game.time - a,
        e.chatCustom = !0,
        void delete e.emote
    }
    void 0 !== lang["chat_" + t] && (e.chat = getTranslation("chat_" + t, i).capitalize(),
    e.chatStartTime = game.time,
    e.chatCustom = !1,
    delete e.emote)
}
function getEmoteById(e) {
    var t = "";
    switch (e) {
    case 1:
        t = "&#128078;";
        break;
    case 2:
        t = "&#128577;";
        break;
    case 3:
        t = "&#128148;";
        break;
    case 4:
        t = "&#128561;";
        break;
    case 5:
        t = "&#128557;";
        break;
    case 6:
        t = "&#128545;";
        break;
    case 7:
        t = "&#128077;";
        break;
    case 8:
        t = "&#128578;";
        break;
    case 9:
        t = "&#128518;";
        break;
    case 10:
        t = "&#128150;";
        break;
    case 11:
        t = "&#128079;";
        break;
    case 12:
        t = "&#128128;";
        break;
    case 13:
        t = "&#128075;"
    }
    return t
}
function askForDiscord() {
    var e = {};
    e.id = user.discordId,
    e.name = user.discordName,
    e.token = user.discordToken,
    gameServer.emit(socketMsgType.ASKDISCORD, {
        myDiscord: e
    }),
    hideEmotesMenu()
}
function sendDiscord(e) {
    if (0 != discordAsksArr.length) {
        var t = {};
        t.id = user.discordId,
        t.name = user.discordName,
        t.token = user.discordToken,
        gameServer.emit(socketMsgType.SENDDISCORD, {
            myDiscord: t,
            character: e
        });
        var a = discordAsksArr.indexOf(e);
        -1 !== a && (discordAsksArr.splice(a, 1),
        refreshDiscordMenu());
        var i = game.gameObjects[e];
        void 0 !== i && (i.askedDiscord = !1)
    }
}
function imageLoadErrorFunc(e) {}
var gameQuality = 1
  , lastGameQuality = null
  , lowPerformanceMode = !1
  , lowPerformanceScore = 0
  , qualityMode = "auto";
function setQuality(e) {
    gameQuality = e;
    var t = window.devicePixelRatio || 1
      , a = window.innerWidth * t
      , i = window.innerHeight * t;
    if (a <= 0 && (a = screen.width * t),
    i <= 0 && (i = screen.height * t),
    a <= 0 && (a = 1920),
    i <= 0 && (i = 1080),
    a > 1920 && (a = 1920),
    i > 1080 && (i = 1080),
    a *= e,
    i *= e,
    a = ceil(a),
    i = ceil(i),
    game.canvas.width == a && game.canvas.height == i || game.setCanvasSize(a, i),
    lastGameQuality != e) {
        lastGameQuality = e
    }
}
null != getCookie("quality") && (qualityMode = getCookie("quality"));
var lastAutomaticQuality = Date.now()
  , automaticQualityAttempts = 0;
function automaticQuality() {
    if (!(Date.now() - lastAutomaticQuality < 5e3))
        if (lastAutomaticQuality = Date.now(),
        "high" != qualityMode)
            if ("medium" != qualityMode)
                if ("low" != qualityMode)
                    if ("ultralow" != qualityMode) {
                        if (gameServer.connected && wasSync && 0 != game.tickNumber && isTabActive && !(Date.now() - lastTabActiveTime < 2e3)) {
                            var e = gameQuality;
                            if (game.fps <= 24)
                                automaticQualityAttempts = 0,
                                e -= .1,
                                lowPerformanceScore++,
                                lowPerformanceScore++;
                            else if (gameQuality >= .7)
                                game.fps < 50 ? (e -= .04,
                                lowPerformanceScore++,
                                automaticQualityAttempts = 0) : game.fps > 55 && ++automaticQualityAttempts > 5 && (e += .01);
                            else if (game.fps >= 59)
                                e = gameQuality + .15;
                            else {
                                if (!(game.fps >= 30))
                                    return;
                                e = gameQuality + .02
                            }
                            e < .5 && !isMobile && (e = .65),
                            e < .4 && isMobile && (e = .4),
                            e > 1 && (e = 1,
                            lowPerformanceScore = 0),
                            lowPerformanceScore >= 3 && (lowPerformanceMode = !0),
                            setQuality(parseFloat(e.toFixed(2)))
                        }
                    } else
                        setQuality(.35);
                else
                    setQuality(.5);
            else
                setQuality(.75);
        else
            setQuality(1)
}
var isTabActive = !0
  , lastTabActiveTime = 0;
window.onfocus = function() {
    isTabActive = !0,
    lastTabActiveTime = Date.now()
}
,
window.onblur = function() {
    isTabActive = !1
}
;
var reportedErrors = [];
window.onerror = function(e, t, a) {
    var i = e + t + a;
    if (!reportedErrors.includes(i)) {
        reportedErrors.push(i);
        var o = "";
        window && window.performance && window.performance.memory && window.performance.memory.totalJSHeapSize && window.performance.memory.usedJSHeapSize && window.performance.memory.jsHeapSizeLimit && (o += "memory: " + window.performance.memory.totalJSHeapSize + " " + window.performance.memory.usedJSHeapSize + " " + window.performance.memory.jsHeapSizeLimit),
        "evoworld.io" == window.location.hostname && $.ajax({
            type: "POST",
            data: {
                error: e,
                url: t,
                line: a,
                info: o,
                userAgent: navigator.userAgent
            },
            url: siteUrl + "api/reportError.php"
        })
    }
}
;
var pingTries = []
  , foundServer = !1;
function getClosestServer() {
    for (var e = [{
        loc: "EUNE",
        ip: "46-183-219-238.evoworld.io"
    }, {
        loc: "EUW",
        ip: "147-135-130-181.evoworld.io"
    }, {
        loc: "NA",
        ip: "144-48-104-66.evoworld.io"
    }, {
        loc: "ASSE",
        ip: "15-235-181-25.evoworld.io"
    }, {
        loc: "ASE",
        ip: "45-250-255-82.evoworld.io"
    }, {
        loc: "ASS",
        ip: "148-113-47-158.evoworld.io"
    }, {
        loc: "ASW",
        ip: "181-215-205-204.evoworld.io"
    }, {
        loc: "SA",
        ip: "189-1-168-53.evoworld.io"
    }, {
        loc: "AUS",
        ip: "139-99-197-162.evoworld.io"
    }], t = 0; t < e.length; t++)
        pingServer(e[t].loc, e[t].ip)
}
function pingServer(e, t) {
    if (!foundServer) {
        for (var a = 0; a < serversList.length; a++) {
            var i = serversList[a];
            if (i.connected)
                return foundServer = !0,
                $("#selectServer").val(i.ip + ":" + i.port),
                void (connectIp = i.ip + ":" + i.port)
        }
        void 0 === pingTries[e] && (pingTries[e] = 0);
        var o = new XMLHttpRequest;
        o.open("GET", "https://" + t + "/?t=" + Date.now(), !0),
        o.onreadystatechange = function() {
            if (4 == o.readyState && 200 == o.status) {
                if (foundServer)
                    return;
                if (pingTries[e]++,
                pingTries[e] < 3)
                    return void pingServer(e, t);
                for (var a = 0; a < serversList.length; a++) {
                    var i = serversList[a];
                    if (i.location == e && i.players < i.maxPlayers) {
                        foundServer = !0,
                        $("#selectServer").val(i.ip + ":" + i.port),
                        connectIp = i.ip + ":" + i.port;
                        break
                    }
                }
            }
        }
        ;
        try {
            o.send(null)
        } catch (e) {
            connectIp = $("#selectServer").val()
        }
    }
}
